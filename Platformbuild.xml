<?xml version="1.0"?>
<project name="PlatformBuild" basedir="/app/Swift" default="All">
	
	<target name="Init">
		<taskdef resource="net/sf/antcontrib/antlib.xml" >
			<classpath>
				<pathelement location="${antcontrib}" />
			</classpath>
		</taskdef>
		<if>
			<equals arg1="${is_windows}" arg2="true" />
			<then>
				<property file="D:/SwiftBuild/SwiftBuild.properties"/>
			</then>
		</if>
		<if>
			<equals arg1="${is_unix}" arg2="true" />
			<then>
				<property file="/app/SwiftBuild/SwiftBuild.properties"/>
			</then>
		</if>
	</target>

	<target name="PlatformLatest" depends="Init">

		<delete dir="${ProjectFolder}"/>
		<mkdir dir="${ProjectFolder}"/>
		
		<exec executable="svn">
			<arg line="export -q --force --username gandivabuild --password pass@000 --trust-server-cert --non-interactive ${PlatformSvnFolder}/Database"/>
			<arg line="${ProjectFolder}/Database"/>
        </exec>
		
		<exec executable="svn">
			<arg line="export -q --force --username gandivabuild --password pass@000 --trust-server-cert --non-interactive ${PlatformSvnFolder}/digite-ejb"/>
			<arg line="${ProjectFolder}/digite-ejb"/>
        </exec>
		
		<exec executable="svn">
			<arg line="export -q --force --username gandivabuild --password pass@000 --trust-server-cert --non-interactive ${PlatformSvnFolder}/digite-war"/>
			<arg line="${ProjectFolder}/digite-war"/>
        </exec>

		<exec executable="svn">
			<arg line="export -q --force --username gandivabuild --password pass@000 --trust-server-cert --non-interactive ${PlatformSvnFolder}/PropertyFiles"/>
			<arg line="${ProjectFolder}/PropertyFiles"/>
        </exec>
		
		<exec executable="svn">
			<arg line="export -q --force --username gandivabuild --password pass@000 --trust-server-cert --non-interactive ${PlatformSvnFolder}/deps"/>
			<arg line="${ProjectFolder}/deps"/>
        </exec>
		
		<exec executable="svn">
			<arg line="export -q --force --username gandivabuild --password pass@000 --trust-server-cert --non-interactive ${PlatformSvnFolder}/src"/>
			<arg line="${ProjectFolder}/src"/>
        </exec>

		<exec executable="svn">
			<arg line="export -q --force --username gandivabuild --password pass@000 --trust-server-cert --non-interactive ${PlatformSvnFolder}/misc/HornetQFiles"/>
			<arg line="${ProjectFolder}/misc/HornetQFiles"/>
        </exec>

		<exec executable="svn">
			<arg line="export -q -N --force --username gandivabuild --password pass@000 --trust-server-cert --non-interactive ${PlatformSvnFolder}"/>
			<arg line="${ProjectFolder}"/>
        </exec>
		
		<echo level="info" message="Platform latest from SVN completed successfully"/>
		
	</target>
	
	<target name="PlatformBuild" depends="PlatformLatest">
		<property file="${ProjectFolder}/build.properties"/>

		<ant antfile="${BuildPlatformEar}" target="clean"/>
		<ant antfile="${BuildPlatformEar}" />
		<echo level="info" message="Platform build Successful"/>
	</target>
	
	<target name="All" depends="PlatformBuild">
		<antcall target="CopyPlatformJars" />
	</target>
	
	<target name="CopyPlatformJars" >
		
		<copy todir="${ProjectFolder}/platform-files/" overwrite="yes" >
	       <fileset file="${ProjectFolder}/dist/digite.ear" />
	    </copy>
		
		<copy todir="${ProjectFolder}/deps/" overwrite="yes" >
	       <fileset file="${ProjectFolder}/digite-ejb/dist/digite-ejb.jar" />
	    </copy>
		
		<copy todir="${ProjectFolder}/deps/" overwrite="yes" >
	       <fileset file="${ProjectFolder}/digite-war/build/web/WEB-INF/lib/digite-web.jar" />
	    </copy>
		
	</target>

</project>